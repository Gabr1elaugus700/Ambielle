{% extends 'global/base.html' %}

{% block content %}
<div class="relatorio-container">
  <h2>Exportar Relat칩rios</h2>

  <!-- Bot칫es de exporta칞칚o -->
  <div class="btn-relatorios">
      <!-- Relat칩rio de Clientes -->
      <button class="btn-download" onclick="baixarCSV('clientes')">游늭 CSV - Clientes</button>
      <button class="btn-download" onclick="baixarPDF('clientes')">游늯 PDF - Clientes</button>

      <!-- Relat칩rio de Clientes x Servi칞os -->
      <button class="btn-download" onclick="baixarCSV('clientes_servicos')">游늭 CSV - Clientes x Servi칞os</button>
      <button class="btn-download" onclick="baixarPDF('clientes_servicos')">游늯 PDF - Clientes x Servi칞os</button>

      <!-- Relat칩rio de Clientes x Servi칞os x Valores -->
      <button class="btn-download" onclick="baixarCSV('clientes_servicos_valores')">游늭 CSV - Clientes x Servi칞os x Valores</button>
      <button class="btn-download" onclick="baixarPDF('clientes_servicos_valores')">游늯 PDF - Clientes x Servi칞os x Valores</button>

      <!-- Relat칩rio de Clientes x Suporte -->
      <button class="btn-download" onclick="baixarCSV('clientes_suporte')">游늭 CSV - Clientes x Suporte</button>
      <button class="btn-download" onclick="baixarPDF('clientes_suporte')">游늯 PDF - Clientes x Suporte</button>

      <!-- Relat칩rio de Demandas por Cliente -->
      <button class="btn-download" onclick="baixarCSV('demandas_por_cliente')">游늭 CSV - Demandas por Cliente</button>
      <button class="btn-download" onclick="baixarPDF('demandas_por_cliente')">游늯 PDF - Demandas por Cliente</button>
  </div>
</div>

<!-- Script para chamar as URLs de exporta칞칚o -->
<script>
  function baixarCSV(tipoRelatorio) {
      window.location.href = `/exportar-csv/${tipoRelatorio}/`;
  }

  function baixarPDF(tipoRelatorio) {
      window.location.href = `/exportar-pdf/${tipoRelatorio}/`;
  }
</script>

  <div class="lista">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Projetos</th>
          <th>Contato</th>
          <th>Email</th>
          <th>#</th>
        </tr>
      </thead>
        {% for cliente in page_obj %}
          <tr>
            <td style="text-align: center;">{{ cliente.id }}</td>
            <td>{{ cliente.nome }}</td>
            <td style="text-align: center;">3</td>
            <td>{{ cliente.contato_principal }}</td>
            <td>{{ cliente.email }}</td>
            <td style="text-align: center; vertical-align: middle;">
              <a href="{% url "workflow:deleteCliente" cliente.id %}" onclick="return confirm('Tem certeza que deseja excluir este item?');"><i class="fa-regular fa-trash-can" style="width: 20px; height: 20px; text-decoration: none; color: var(--secondary-color);"></i></a>
              <a href="{% url "workflow:updateCliente" cliente.id %}"><i class="fa-regular fa-pen-to-square" style="width: 20px; height: 20px; text-decoration: none; color: var(--secondary-color);"></i></a>
            </td>
          </tr>
          <tr>
            <td style="text-align: center;" class="sublist" colspan="6">
              <strong>Tarefas:</strong>
              {% if cliente.tarefas_em_aberto %}
                <ul>
                  {% for tarefa in cliente.tarefas_em_aberto %}
                    <li>
                      {{ tarefa.tipo_servico }} - <em>{{ tarefa.prazo_final|date:"d/m/Y" }}</em>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p>Sem tarefas.</p>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        
      </tbody>
      <tfoot>
        <tr>
          <td colspan="6" class="tfoot-cell">
            <div class="pagination">
              <!-- Bot칫es de navega칞칚o com 칤cones -->
              <span class="step-links">
                {% if page_obj.has_previous %}
                  <a href="?page=1">
                    <i class="fa-solid fa-angles-left"></i> <!-- 칈cone para primeira p치gina -->
                  </a>z
                  <a href="?page={{ page_obj.previous_page_number }}">
                    <i class="fa-solid fa-angle-left"></i> <!-- 칈cone para p치gina anterior -->
                  </a>
                {% endif %}

                <span class="current">
                    P치gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}">
                    <i class="fa-solid fa-angle-right"></i> <!-- 칈cone para pr칩xima p치gina -->
                  </a>
                  <a href="?page={{ page_obj.paginator.num_pages }}">
                    <i class="fa-solid fa-angles-right"></i> <!-- 칈cone para 칰ltima p치gina -->
                  </a>
                {% endif %}
              </span>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
{% endblock %}
